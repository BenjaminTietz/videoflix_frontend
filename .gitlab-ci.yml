stages:
  - build
  - deploy

variables:
  NODE_VERSION: "21"

build_job:
  stage: build
  image: node:${NODE_VERSION}-alpine
  script:
    - echo "Verwende Node.js Version ${NODE_VERSION}"
    - npm install
    - npm run build --if-present
  artifacts:
    paths:
      - dist/videoflix_frontend/browser

deploy_job:
  stage: deploy
  image: alpine:latest
  before_script:
    - apk add --no-cache curl
  dependencies:
    - build_job
  script:
    - echo "Starte den FTPS-Upload..."
    - |
      find ./dist/videoflix_frontend/browser -type f | while read file; do
        remote_path="${file#./dist/videoflix_frontend/browser/}"  # Entfernt den dist-Pfad
        curl --ssl-reqd --tls-max 1.2 --ftp-create-dirs --user "$ALEXUSERNAME:$ALEXPASSWORD" -T "$file" "ftps://${ALEXHOST}:21/$remote_path"
      done
  only:
    - alex